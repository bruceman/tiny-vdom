"use strict";function unescapeChar(e){return unescapes[e]}function Element(e,t,r){if(!(this instanceof Element))return _.isArray(r)||null==r||(r=_.slice(arguments,2).filter(_.truthy)),new Element(e,t,r);_.isArray(t)&&(r=t,t={}),this.tagName=e,this.props=t||{},this.children=r||[],this.key=t?t.key:void 0;var n=0;_.each(this.children,function(e,t){e instanceof Element?n+=e.count:r[t]=""+e,n++}),this.count=n}function isClosed(e){return"/"===e||">"===e}function isSpace(e){return regSpace.test(e)}function parseTagName(e){if("<"!==e.currentChar())throw Error('This is not a HTML tag. HTML tag has to start with "<"');for(var t="",r=e.nextChar();r&&!isSpace(r)&&!isClosed(r);)t+=r,r=e.nextChar();return t}function parseAttributeName(e){for(var t=e.currentChar(),r="";t;){if(isSpace(t)||isClosed(t)||"="===t){e.skip(-1);break}r+=t,t=e.nextChar()}return r}function parseAttributeValue(e){var t=e.currentChar(),r=quotas.indexOf(t)>=0?t:null;r&&(t=e.nextChar());for(var n="";t;){if(r){if(t===r&&"\\"!==e.peek(-1))break;n+=t}else{if(isSpace(t)||isClosed(t))break;n+=t}t=e.nextChar()}return n}function parseAttributes(e){for(var t="",r=e.currentChar(),n={};r&&(isSpace(r)&&(r=skipBlank(e)),!isClosed(r));)t=parseAttributeName(e),"="===(r=skipBlank(e))?(skipBlank(e),n[t]=_.unescapeString(parseAttributeValue(e)),e.nextChar()):t&&!n.hasOwnProperty(t)&&(n[t]=!0);return n}function skipBlank(e){var t=null;do{t=e.nextChar()}while(t&&isSpace(t));return t}function parse$2(e){var t=new sourceComponent(e);return{tagName:parseTagName(t),attributes:parseAttributes(t)}}function parse(e){var t,r=[],n=-1,i=[],a={};if((e=e.trim()).replace(tagRE,function(s,o){var u,c="/"!==s.charAt(1),l=o+s.length,p=e.charAt(l);c&&(n++,!(t=parseTag(s)).voidElement&&p&&"<"!==p&&t.children.push({type:"text",content:_.unescapeString(e.slice(l,e.indexOf("<",l)))}),a[t.tagName]=t,0===n&&r.push(t),(u=i[n-1])&&u.children.push(t),i[n]=t),c&&!t.voidElement||(n--,"<"!==p&&p&&i[n].children.push({type:"text",content:_.unescapeString(e.slice(l,e.indexOf("<",l)))}))}),1!==r.length)throw new Error("Must have one root element");return toElement(r[0])}function parseTag(e){var t=parse$2(e),r=lookup[t.tagName]||"/>"===e.substring(e.length-2);return{type:"tag",name:t.tagName,voidElement:r,attrs:t.attributes,children:[]}}function toElement(e){var t=[];return e.children.forEach(function(e){"text"==e.type?t.push(e.content):t.push(toElement(e))}),Element(e.name,e.attrs,t)}function diff$2(e,t,r){function n(e){var t={index:e,type:0};f.push(t)}function i(e,t){var r={index:e,item:t,type:1};f.push(r)}function a(e){v.splice(e,1)}for(var s,o,u=makeKeyIndexAndFree(e,r),c=makeKeyIndexAndFree(t,r),l=c.free,p=u.keyIndex,h=c.keyIndex,f=[],d=[],m=0,y=0;m<e.length;){if(s=e[m],o=getItemKey(s,r))if(h.hasOwnProperty(o)){var g=h[o];d.push(t[g])}else d.push(null);else{var k=l[y++];d.push(k||null)}m++}var v=d.slice(0);for(m=0;m<v.length;)null===v[m]?(n(m),a(m)):m++;for(var x=m=0;m<t.length;){o=getItemKey(s=t[m],r);var E=v[x],b=getItemKey(E,r);if(E)if(o===b)x++;else if(p.hasOwnProperty(o)){getItemKey(v[x+1],r)===o?(n(m),a(x),x++):i(m,s)}else i(m,s);else i(m,s);m++}return{moves:f,children:d}}function makeKeyIndexAndFree(e,t){for(var r={},n=[],i=0,a=e.length;i<a;i++){var s=e[i],o=getItemKey(s,t);o?r[o]=i:n.push(s)}return{keyIndex:r,free:n}}function getItemKey(e,t){if(e&&t)return"string"==typeof t?e[t]:t(e)}function patch(e,t){dfsWalk$1(e,{index:0},t)}function dfsWalk$1(e,t,r){for(var n=r[t.index],i=e.childNodes?e.childNodes.length:0,a=0;a<i;a++){var s=e.childNodes[a];t.index++,dfsWalk$1(s,t,r)}n&&applyPatches(e,n)}function applyPatches(e,t){_.each(t,function(t){switch(t.type){case REPLACE:var r="string"==typeof t.node?document.createTextNode(t.node):t.node.render();e.parentNode.replaceChild(r,e);break;case REORDER:reorderChildren(e,t.moves);break;case PROPS:setProps(e,t.props);break;case TEXT:e.textContent?e.textContent=t.content:e.nodeValue=t.content;break;default:throw new Error("Unknown patch type "+t.type)}})}function setProps(e,t){for(var r in t)if(void 0===t[r])e.removeAttribute(r);else{var n=t[r];_.setAttr(e,r,n)}}function reorderChildren(e,t){var r=_.toArray(e.childNodes),n={};_.each(r,function(e){if(1===e.nodeType){var t=e.getAttribute("key");t&&(n[t]=e)}}),_.each(t,function(t){var i=t.index;if(0===t.type)r[i]&&r[i]===e.childNodes[i]&&e.removeChild(e.childNodes[i]),r.splice(i,1);else if(1===t.type){var a=n[t.item.key]?n[t.item.key].cloneNode(!0):"object"===_typeof(t.item)?t.item.render():document.createTextNode(t.item);r.splice(i,0,a),e.insertBefore(a,e.childNodes[i]||null)}})}function diff(e,t){var r={};return dfsWalk(e,t,0,r),r}function dfsWalk(e,t,r,n){var i=[];if(null===t);else if(_.isString(e)&&_.isString(t))t!==e&&i.push({type:patch.TEXT,content:t});else if(e.tagName===t.tagName&&e.key===t.key){var a=diffProps(e,t);a&&i.push({type:patch.PROPS,props:a}),isIgnoreChildren(t)||diffChildren(e.children,t.children,r,n,i)}else i.push({type:patch.REPLACE,node:t});i.length&&(n[r]=i)}function diffChildren(e,t,r,n,i){var a=listDiff2(e,t,"key");if(t=a.children,a.moves.length){var s={type:patch.REORDER,moves:a.moves};i.push(s)}var o=null,u=r;_.each(e,function(e,r){dfsWalk(e,t[r],u=o&&o.count?u+o.count+1:u+1,n),o=e})}function diffProps(e,t){var r,n,i=0,a=e.props,s=t.props,o={};for(r in a)n=a[r],s[r]!==n&&(i++,o[r]=s[r]);for(r in s)n=s[r],a.hasOwnProperty(r)||(i++,o[r]=s[r]);return 0===i?null:o}function isIgnoreChildren(e){return e.props&&e.props.hasOwnProperty("ignore")}var _={},unescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`","&#x3D;":"="},unescapeRE=/(&amp;)|(&lt;)|(&gt;)|(&quot;)|(&#x27;)|(&#x60;)|(&#x3D;)/g;_.unescapeString=function(e){return unescapeRE.test(e)?e.replace(unescapeRE,unescapeChar):e},_.type=function(e){return Object.prototype.toString.call(e).replace(/\[object\s|\]/g,"")},_.isArray=function(e){return"Array"===_.type(e)},_.slice=function(e,t){return Array.prototype.slice.call(e,t)},_.truthy=function(e){return!!e},_.isString=function(e){return"String"===_.type(e)},_.each=function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)},_.toArray=function(e){if(!e)return[];for(var t=[],r=0,n=e.length;r<n;r++)t.push(e[r]);return t},_.setAttr=function(e,t,r){switch(t){case"style":e.style.cssText=r;break;case"value":var n=e.tagName||"";"input"===(n=n.toLowerCase())||"textarea"===n?e.value=r:e.setAttribute(t,r);break;default:e.setAttribute(t,r)}},Element.prototype.render=function(){var e=document.createElement(this.tagName),t=this.props;for(var r in t){var n=t[r];_.setAttr(e,r,n)}return _.each(this.children,function(t){var r=t instanceof Element?t.render():document.createTextNode(t);e.appendChild(r)}),e};var sourceComponent=class{constructor(e){this.html=e,this.index=0}currentChar(){return this.html[this.index]}currentIndex(){return this.index}charAt(e){return this.html[e]}nextChar(){if(this.index++,!(this.index>=this.html.length))return this.currentChar()}getSubstring(e,t){return t=t||this.html.length,this.html.slice(e,t)}peek(e){return e=void 0==e?1:e,this.html[this.index+e]}skip(e){this.index+=e}getNext(e){return this.getSubstring(this.index,this.index+e)}isNext(e){for(let t=0;t<e.length;t++)if(this.peek(t)!==e[t])return!1;return!0}length(){return this.html.length}static isNumber(e){return this.isDefined(e)&&"number"==typeof e}static isDigit(e){return this.isDefined(e)&&!isNaN(parseFloat(e))&&isFinite(e)&&(1===e.length||e<10&&e>0)}static isLetter(e){return this.isDefined(e)&&/^[a-zA-Z]/.test(e)&&1===e.length}static isDefined(e){return void 0!==e}static isLetterOrDigit(e){return this.isDefined(e)&&this.isDigit(e)||this.isLetter(e)}static isSpecialCharacter(e){return this.isDefined(e)&&"string"==typeof e&&/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(char)&&1===char.length}},quotas="\"'",regSpace=/^\s$/,tagRE=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,lookup=Object.create?Object.create(null):{};lookup.area=!0,lookup.base=!0,lookup.br=!0,lookup.col=!0,lookup.embed=!0,lookup.hr=!0,lookup.img=!0,lookup.input=!0,lookup.keygen=!0,lookup.link=!0,lookup.menuitem=!0,lookup.meta=!0,lookup.param=!0,lookup.source=!0,lookup.track=!0,lookup.wbr=!0;var makeKeyIndexAndFree_1=makeKeyIndexAndFree,diff_2=diff$2,diff_1={makeKeyIndexAndFree:makeKeyIndexAndFree_1,diff:diff_2},listDiff2=diff_1.diff,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},REPLACE=0,REORDER=1,PROPS=2,TEXT=3;patch.REPLACE=REPLACE,patch.REORDER=REORDER,patch.PROPS=PROPS,patch.TEXT=TEXT;var main={element:Element,parse:parse,diff:diff,patch:patch};module.exports=main;