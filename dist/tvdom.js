!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.tvdom=t()}(this,function(){"use strict";function e(e){return y[e]}function t(e,n,r){if(!(this instanceof t))return d.isArray(r)||null==r||(r=d.slice(arguments,2).filter(d.truthy)),new t(e,n,r);d.isArray(n)&&(r=n,n={}),this.tagName=e,this.props=n||{},this.children=r||[],this.key=n?n.key:void 0;var i=0;d.each(this.children,function(e,n){e instanceof t?i+=e.count:r[n]=""+e,i++}),this.count=i}function n(e){return"/"===e||">"===e}function r(e){return C.test(e)}function i(e){for(var t=e.currentChar(),i="";t;){if(r(t)||n(t)||"="===t){e.skip(-1);break}i+=t,t=e.nextChar()}return i}function o(e){var t=e.currentChar(),i=k.indexOf(t)>=0?t:null;i&&(t=e.nextChar());for(var o="";t;){if(i){if(t===i&&"\\"!==e.peek(-1))break;o+=t}else{if(r(t)||n(t))break;o+=t}t=e.nextChar()}return o}function a(e){var t=null;do{t=e.nextChar()}while(t&&r(t));return t}function u(e){var t=new b(e);return{tagName:function(e){if("<"!==e.currentChar())throw Error('This is not a HTML tag. HTML tag has to start with "<"');for(var t="",i=e.nextChar();i&&!r(i)&&!n(i);)t+=i,i=e.nextChar();return t}(t),attributes:function(e){for(var t="",u=e.currentChar(),c={};u&&(r(u)&&(u=a(e)),!n(u));)t=i(e),"="===(u=a(e))?(a(e),c[t]=d.unescapeString(o(e)),e.nextChar()):t&&!c.hasOwnProperty(t)&&(c[t]=!0);return c}(t)}}function c(e){var n=[];return e.children.forEach(function(e){"text"==e.type?n.push(e.content):n.push(c(e))}),t(e.name,e.attrs,n)}function s(e,t){for(var n={},r=[],i=0,o=e.length;i<o;i++){var a=e[i],u=f(a,t);u?n[u]=i:r.push(a)}return{keyIndex:n,free:r}}function f(e,t){if(e&&t)return"string"==typeof t?e[t]:t(e)}function l(e,t){h(e,{index:0},t)}function h(e,t,n){for(var r=n[t.index],i=e.childNodes?e.childNodes.length:0,o=0;o<i;o++){var a=e.childNodes[o];t.index++,h(a,t,n)}r&&function(e,t){d.each(t,function(t){switch(t.type){case E:var n="string"==typeof t.node?document.createTextNode(t.node):t.node.render();e.parentNode.replaceChild(n,e);break;case O:!function(e,t){var n=d.toArray(e.childNodes),r={};d.each(n,function(e){if(1===e.nodeType){var t=e.getAttribute("key");t&&(r[t]=e)}}),d.each(t,function(t){var i=t.index;if(0===t.type)n[i]&&n[i]===e.childNodes[i]&&e.removeChild(e.childNodes[i]),n.splice(i,1);else if(1===t.type){var o=r[t.item.key]?r[t.item.key].cloneNode(!0):"object"===m(t.item)?t.item.render():document.createTextNode(t.item);n.splice(i,0,o),e.insertBefore(o,e.childNodes[i]||null)}})}(e,t.moves);break;case S:!function(e,t){for(var n in t)if(void 0===t[n])e.removeAttribute(n);else{var r=t[n];d.setAttr(e,n,r)}}(e,t.props);break;case T:e.textContent?e.textContent=t.content:e.nodeValue=t.content;break;default:throw new Error("Unknown patch type "+t.type)}})}(e,r)}function p(e,t,n,r){var i=[];if(null===t);else if(d.isString(e)&&d.isString(t))t!==e&&i.push({type:l.TEXT,content:t});else if(e.tagName===t.tagName&&e.key===t.key){var o=function(e,t){var n,r,i=0,o=e.props,a=t.props,u={};for(n in o)r=o[n],a[n]!==r&&(i++,u[n]=a[n]);for(n in a)r=a[n],o.hasOwnProperty(n)||(i++,u[n]=a[n]);if(0===i)return null;return u}(e,t);o&&i.push({type:l.PROPS,props:o}),function(e){return e.props&&e.props.hasOwnProperty("ignore")}(t)||function(e,t,n,r,i){var o=A(e,t,"key");if(t=o.children,o.moves.length){var a={type:l.REORDER,moves:o.moves};i.push(a)}var u=null,c=n;d.each(e,function(e,n){var i=t[n];c=u&&u.count?c+u.count+1:c+1,p(e,i,c,r),u=e})}(e.children,t.children,n,r,i)}else i.push({type:l.REPLACE,node:t});i.length&&(r[n]=i)}var d={},y={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`","&#x3D;":"="},v=/(&amp;)|(&lt;)|(&gt;)|(&quot;)|(&#x27;)|(&#x60;)|(&#x3D;)/g;d.unescapeString=function(t){return v.test(t)?t.replace(v,e):t},d.type=function(e){return Object.prototype.toString.call(e).replace(/\[object\s|\]/g,"")},d.isArray=function(e){return"Array"===d.type(e)},d.slice=function(e,t){return Array.prototype.slice.call(e,t)},d.truthy=function(e){return!!e},d.isString=function(e){return"String"===d.type(e)},d.each=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},d.toArray=function(e){if(!e)return[];for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},d.setAttr=function(e,t,n){switch(t){case"style":e.style.cssText=n;break;case"value":var r=e.tagName||"";"input"===(r=r.toLowerCase())||"textarea"===r?e.value=n:e.setAttribute(t,n);break;default:e.setAttribute(t,n)}},t.prototype.render=function(){var e=document.createElement(this.tagName),n=this.props;for(var r in n){var i=n[r];d.setAttr(e,r,i)}return d.each(this.children,function(n){var r=n instanceof t?n.render():document.createTextNode(n);e.appendChild(r)}),e};var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},x=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),b=function(){function e(t){g(this,e),this.str=t,this.index=0}return x(e,[{key:"currentChar",value:function(){return this.str[this.index]}},{key:"currentIndex",value:function(){return this.index}},{key:"charAt",value:function(e){return this.str[e]}},{key:"nextChar",value:function(){if(this.index++,!(this.index>=this.str.length))return this.currentChar()}},{key:"peek",value:function(e){return e=void 0==e?1:e,this.str[this.index+e]}},{key:"skip",value:function(e){this.index+=e}},{key:"length",value:function(){return this.str.length}}]),e}(),k="\"'",C=/^\s$/,w=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,N=Object.create?Object.create(null):{};N.area=!0,N.base=!0,N.br=!0,N.col=!0,N.embed=!0,N.hr=!0,N.img=!0,N.input=!0,N.keygen=!0,N.link=!0,N.menuitem=!0,N.meta=!0,N.param=!0,N.source=!0,N.track=!0,N.wbr=!0;var A={makeKeyIndexAndFree:s,diff:function(e,t,n){function r(e){var t={index:e,type:0};y.push(t)}function i(e,t){var n={index:e,item:t,type:1};y.push(n)}function o(e){k.splice(e,1)}for(var a,u,c=s(e,n),l=s(t,n),h=l.free,p=c.keyIndex,d=l.keyIndex,y=[],v=[],m=0,g=0;m<e.length;){if(a=e[m],u=f(a,n))if(d.hasOwnProperty(u)){var x=d[u];v.push(t[x])}else v.push(null);else{var b=h[g++];v.push(b||null)}m++}var k=v.slice(0);for(m=0;m<k.length;)null===k[m]?(r(m),o(m)):m++;for(var C=m=0;m<t.length;){u=f(a=t[m],n);var w=k[C],N=f(w,n);w?u===N?C++:p.hasOwnProperty(u)&&f(k[C+1],n)===u?(r(m),o(C),C++):i(m,a):i(m,a),m++}return{moves:y,children:v}}}.diff,E=0,O=1,S=2,T=3;l.REPLACE=E,l.REORDER=O,l.PROPS=S,l.TEXT=T;return{element:t,parse:function(e){var t,n=[],r=-1,i=[],o={};if((e=e.trim()).replace(w,function(a,c){var s,f="/"!==a.charAt(1),l=c+a.length,h=e.charAt(l);f&&(r++,!(t=function(e){var t=u(e),n=N[t.tagName]||"/>"===e.substring(e.length-2);return{type:"tag",name:t.tagName,voidElement:n,attrs:t.attributes,children:[]}}(a)).voidElement&&h&&"<"!==h&&t.children.push({type:"text",content:d.unescapeString(e.slice(l,e.indexOf("<",l)))}),o[t.tagName]=t,0===r&&n.push(t),(s=i[r-1])&&s.children.push(t),i[r]=t),f&&!t.voidElement||(r--,"<"!==h&&h&&i[r].children.push({type:"text",content:d.unescapeString(e.slice(l,e.indexOf("<",l)))}))}),1!==n.length)throw new Error("Must have one root element");return c(n[0])},diff:function(e,t){var n={};return p(e,t,0,n),n},patch:l}});