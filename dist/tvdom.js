!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.tvdom=t()}(this,function(){"use strict";function e(t,n,r){if(!(this instanceof e))return s.isArray(r)||null==r||(r=s.slice(arguments,2).filter(s.truthy)),new e(t,n,r);s.isArray(n)&&(r=n,n={}),this.tagName=t,this.props=n||{},this.children=r||[],this.key=n?n.key:void 0;var o=0;s.each(this.children,function(t,n){t instanceof e?o+=t.count:r[n]=""+t,o++}),this.count=o}function t(e){return h[e]}function n(e){return d.test(e)?e.replace(d,t):e}function r(t){var n=[];return t.children.forEach(function(e){"text"==e.type?n.push(e.content):n.push(r(e))}),e(t.name,t.attrs,n)}function o(e,t){for(var n={},r=[],o=0,c=e.length;o<c;o++){var a=e[o],u=i(a,t);u?n[u]=o:r.push(a)}return{keyIndex:n,free:r}}function i(e,t){if(e&&t)return"string"==typeof t?e[t]:t(e)}function c(e,t){a(e,{index:0},t)}function a(e,t,n){for(var r=n[t.index],o=e.childNodes?e.childNodes.length:0,i=0;i<o;i++){var c=e.childNodes[i];t.index++,a(c,t,n)}r&&function(e,t){s.each(t,function(t){switch(t.type){case m:var n="string"==typeof t.node?document.createTextNode(t.node):t.node.render();e.parentNode.replaceChild(n,e);break;case g:!function(e,t){var n=s.toArray(e.childNodes),r={};s.each(n,function(e){if(1===e.nodeType){var t=e.getAttribute("key");t&&(r[t]=e)}}),s.each(t,function(t){var o=t.index;if(0===t.type)n[o]&&n[o]===e.childNodes[o]&&e.removeChild(e.childNodes[o]),n.splice(o,1);else if(1===t.type){var i=r[t.item.key]?r[t.item.key].cloneNode(!0):"object"===v(t.item)?t.item.render():document.createTextNode(t.item);n.splice(o,0,i),e.insertBefore(i,e.childNodes[o]||null)}})}(e,t.moves);break;case x:!function(e,t){for(var n in t)if(void 0===t[n])e.removeAttribute(n);else{var r=t[n];s.setAttr(e,n,r)}}(e,t.props);break;case b:e.textContent?e.textContent=t.content:e.nodeValue=t.content;break;default:throw new Error("Unknown patch type "+t.type)}})}(e,r)}function u(e,t,n,r){var o=[];if(null===t);else if(s.isString(e)&&s.isString(t))t!==e&&o.push({type:c.TEXT,content:t});else if(e.tagName===t.tagName&&e.key===t.key){var i=function(e,t){var n,r,o=0,i=e.props,c=t.props,a={};for(n in i)r=i[n],c[n]!==r&&(o++,a[n]=c[n]);for(n in c)r=c[n],i.hasOwnProperty(n)||(o++,a[n]=c[n]);if(0===o)return null;return a}(e,t);i&&o.push({type:c.PROPS,props:i}),function(e){return e.props&&e.props.hasOwnProperty("ignore")}(t)||function(e,t,n,r,o){var i=y(e,t,"key");if(t=i.children,i.moves.length){var a={type:c.REORDER,moves:i.moves};o.push(a)}var l=null,f=n;s.each(e,function(e,n){var o=t[n];f=l&&l.count?f+l.count+1:f+1,u(e,o,f,r),l=e})}(e.children,t.children,n,r,o)}else o.push({type:c.REPLACE,node:t});o.length&&(r[n]=o)}var s={};s.type=function(e){return Object.prototype.toString.call(e).replace(/\[object\s|\]/g,"")},s.isArray=function(e){return"Array"===s.type(e)},s.slice=function(e,t){return Array.prototype.slice.call(e,t)},s.truthy=function(e){return!!e},s.isString=function(e){return"String"===s.type(e)},s.each=function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},s.toArray=function(e){if(!e)return[];for(var t=[],n=0,r=e.length;n<r;n++)t.push(e[n]);return t},s.setAttr=function(e,t,n){switch(t){case"style":e.style.cssText=n;break;case"value":var r=e.tagName||"";"input"===(r=r.toLowerCase())||"textarea"===r?e.value=n:e.setAttribute(t,n);break;default:e.setAttribute(t,n)}},e.prototype.render=function(){var t=document.createElement(this.tagName),n=this.props;for(var r in n){var o=n[r];s.setAttr(t,r,o)}return s.each(this.children,function(n){var r=n instanceof e?n.render():document.createTextNode(n);t.appendChild(r)}),t};var l=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,f=/([\w-]+)|['"]{1}([^'"]*)['"]{1}/g,p=Object.create?Object.create(null):{};p.area=!0,p.base=!0,p.br=!0,p.col=!0,p.embed=!0,p.hr=!0,p.img=!0,p.input=!0,p.keygen=!0,p.link=!0,p.menuitem=!0,p.meta=!0,p.param=!0,p.source=!0,p.track=!0,p.wbr=!0;var h={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`","&#x3D;":"="},d=/(&amp;)|(&lt;)|(&gt;)|(&quot;)|(&#x27;)|(&#x60;)|(&#x3D;)/g,y={makeKeyIndexAndFree:o,diff:function(e,t,n){function r(e){var t={index:e,type:0};y.push(t)}function c(e,t){var n={index:e,item:t,type:1};y.push(n)}function a(e){k.splice(e,1)}for(var u,s,l=o(e,n),f=o(t,n),p=f.free,h=l.keyIndex,d=f.keyIndex,y=[],v=[],m=0,g=0;m<e.length;){if(u=e[m],s=i(u,n))if(d.hasOwnProperty(s)){var x=d[s];v.push(t[x])}else v.push(null);else{var b=p[g++];v.push(b||null)}m++}var k=v.slice(0);for(m=0;m<k.length;)null===k[m]?(r(m),a(m)):m++;for(var A=m=0;m<t.length;){s=i(u=t[m],n);var E=k[A],N=i(E,n);E?s===N?A++:h.hasOwnProperty(s)&&i(k[A+1],n)===s?(r(m),a(A),A++):c(m,u):c(m,u),m++}return{moves:y,children:v}}}.diff,v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m=0,g=1,x=2,b=3;c.REPLACE=m,c.REORDER=g,c.PROPS=x,c.TEXT=b;return{element:e,parse:function(e){var t,o=[],i=-1,c=[],a={};if((e=e.trim()).replace(l,function(r,u){var s,l="/"!==r.charAt(1),h=u+r.length,d=e.charAt(h);l&&(i++,!(t=function(e){var t,r=0,o={type:"tag",name:"",voidElement:!1,attrs:{},children:[]};return e.replace(f,function(i){r%2?t=i:0===r?((p[i]||"/"===e.charAt(e.length-2))&&(o.voidElement=!0),o.name=i):o.attrs[t]=n(i.replace(/['"]/g,"")),r++}),o}(r)).voidElement&&d&&"<"!==d&&t.children.push({type:"text",content:n(e.slice(h,e.indexOf("<",h)))}),a[t.tagName]=t,0===i&&o.push(t),(s=c[i-1])&&s.children.push(t),c[i]=t),l&&!t.voidElement||(i--,"<"!==d&&d&&c[i].children.push({type:"text",content:n(e.slice(h,e.indexOf("<",h)))}))}),1!==o.length)throw new Error("Must have one root element");return r(o[0])},diff:function(e,t){var n={};return u(e,t,0,n),n},patch:c}});