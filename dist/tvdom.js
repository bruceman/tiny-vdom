!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.tvdom=t()}(this,function(){"use strict";function e(e){return y[e]}function t(e,r,n){if(!(this instanceof t))return d.isArray(n)||null==n||(n=d.slice(arguments,2).filter(d.truthy)),new t(e,r,n);d.isArray(r)&&(n=r,r={}),this.tagName=e,this.props=r||{},this.children=n||[],this.key=r?r.key:void 0;var i=0;d.each(this.children,function(e,r){e instanceof t?i+=e.count:n[r]=""+e,i++}),this.count=i}function r(e){return"/"===e||">"===e}function n(e){return x.test(e)}function i(e){for(var t=e.currentChar(),i="";t;){if(n(t)||r(t)||"="===t){e.skip(-1);break}i+=t,t=e.nextChar()}return i}function o(e){var t=e.currentChar(),i=g.indexOf(t)>=0?t:null;i&&(t=e.nextChar());for(var o="";t;){if(i){if(t===i&&"\\"!==e.peek(-1))break;o+=t}else{if(n(t)||r(t))break;o+=t}t=e.nextChar()}return o}function a(e){var t=null;do{t=e.nextChar()}while(t&&n(t));return t}function s(e){var t=new m(e);return{tagName:function(e){if("<"!==e.currentChar())throw Error('This is not a HTML tag. HTML tag has to start with "<"');for(var t="",i=e.nextChar();i&&!n(i)&&!r(i);)t+=i,i=e.nextChar();return t}(t),attributes:function(e){for(var t="",s=e.currentChar(),u={};s&&(n(s)&&(s=a(e)),!r(s));)t=i(e),"="===(s=a(e))?(a(e),u[t]=d.unescapeString(o(e)),e.nextChar()):t&&!u.hasOwnProperty(t)&&(u[t]=!0);return u}(t)}}function u(e){var r=[];return e.children.forEach(function(e){"text"==e.type?r.push(e.content):r.push(u(e))}),t(e.name,e.attrs,r)}function c(e,t){for(var r={},n=[],i=0,o=e.length;i<o;i++){var a=e[i],s=h(a,t);s?r[s]=i:n.push(a)}return{keyIndex:r,free:n}}function h(e,t){if(e&&t)return"string"==typeof t?e[t]:t(e)}function f(e,t){l(e,{index:0},t)}function l(e,t,r){for(var n=r[t.index],i=e.childNodes?e.childNodes.length:0,o=0;o<i;o++){var a=e.childNodes[o];t.index++,l(a,t,r)}n&&function(e,t){d.each(t,function(t){switch(t.type){case A:var r="string"==typeof t.node?document.createTextNode(t.node):t.node.render();e.parentNode.replaceChild(r,e);break;case w:!function(e,t){var r=d.toArray(e.childNodes),n={};d.each(r,function(e){if(1===e.nodeType){var t=e.getAttribute("key");t&&(n[t]=e)}}),d.each(t,function(t){var i=t.index;if(0===t.type)r[i]&&r[i]===e.childNodes[i]&&e.removeChild(e.childNodes[i]),r.splice(i,1);else if(1===t.type){var o=n[t.item.key]?n[t.item.key].cloneNode(!0):"object"===C(t.item)?t.item.render():document.createTextNode(t.item);r.splice(i,0,o),e.insertBefore(o,e.childNodes[i]||null)}})}(e,t.moves);break;case S:!function(e,t){for(var r in t)if(void 0===t[r])e.removeAttribute(r);else{var n=t[r];d.setAttr(e,r,n)}}(e,t.props);break;case E:e.textContent?e.textContent=t.content:e.nodeValue=t.content;break;default:throw new Error("Unknown patch type "+t.type)}})}(e,n)}function p(e,t,r,n){var i=[];if(null===t);else if(d.isString(e)&&d.isString(t))t!==e&&i.push({type:f.TEXT,content:t});else if(e.tagName===t.tagName&&e.key===t.key){var o=function(e,t){var r,n,i=0,o=e.props,a=t.props,s={};for(r in o)n=o[r],a[r]!==n&&(i++,s[r]=a[r]);for(r in a)n=a[r],o.hasOwnProperty(r)||(i++,s[r]=a[r]);if(0===i)return null;return s}(e,t);o&&i.push({type:f.PROPS,props:o}),function(e){return e.props&&e.props.hasOwnProperty("ignore")}(t)||function(e,t,r,n,i){var o=N(e,t,"key");if(t=o.children,o.moves.length){var a={type:f.REORDER,moves:o.moves};i.push(a)}var s=null,u=r;d.each(e,function(e,r){var i=t[r];u=s&&s.count?u+s.count+1:u+1,p(e,i,u,n),s=e})}(e.children,t.children,r,n,i)}else i.push({type:f.REPLACE,node:t});i.length&&(n[r]=i)}var d={},y={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#x27;":"'","&#x60;":"`","&#x3D;":"="},v=/(&amp;)|(&lt;)|(&gt;)|(&quot;)|(&#x27;)|(&#x60;)|(&#x3D;)/g;d.unescapeString=function(t){return v.test(t)?t.replace(v,e):t},d.type=function(e){return Object.prototype.toString.call(e).replace(/\[object\s|\]/g,"")},d.isArray=function(e){return"Array"===d.type(e)},d.slice=function(e,t){return Array.prototype.slice.call(e,t)},d.truthy=function(e){return!!e},d.isString=function(e){return"String"===d.type(e)},d.each=function(e,t){for(var r=0,n=e.length;r<n;r++)t(e[r],r)},d.toArray=function(e){if(!e)return[];for(var t=[],r=0,n=e.length;r<n;r++)t.push(e[r]);return t},d.setAttr=function(e,t,r){switch(t){case"style":e.style.cssText=r;break;case"value":var n=e.tagName||"";"input"===(n=n.toLowerCase())||"textarea"===n?e.value=r:e.setAttribute(t,r);break;default:e.setAttribute(t,r)}},t.prototype.render=function(){var e=document.createElement(this.tagName),r=this.props;for(var n in r){var i=r[n];d.setAttr(e,n,i)}return d.each(this.children,function(r){var n=r instanceof t?r.render():document.createTextNode(r);e.appendChild(n)}),e};var m=class{constructor(e){this.html=e,this.index=0}currentChar(){return this.html[this.index]}currentIndex(){return this.index}charAt(e){return this.html[e]}nextChar(){if(this.index++,!(this.index>=this.html.length))return this.currentChar()}getSubstring(e,t){return t=t||this.html.length,this.html.slice(e,t)}peek(e){return e=void 0==e?1:e,this.html[this.index+e]}skip(e){this.index+=e}getNext(e){return this.getSubstring(this.index,this.index+e)}isNext(e){for(let t=0;t<e.length;t++)if(this.peek(t)!==e[t])return!1;return!0}length(){return this.html.length}static isNumber(e){return this.isDefined(e)&&"number"==typeof e}static isDigit(e){return this.isDefined(e)&&!isNaN(parseFloat(e))&&isFinite(e)&&(1===e.length||e<10&&e>0)}static isLetter(e){return this.isDefined(e)&&/^[a-zA-Z]/.test(e)&&1===e.length}static isDefined(e){return void 0!==e}static isLetterOrDigit(e){return this.isDefined(e)&&this.isDigit(e)||this.isLetter(e)}static isSpecialCharacter(e){return this.isDefined(e)&&"string"==typeof e&&/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g.test(char)&&1===char.length}},g="\"'",x=/^\s$/,b=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,k=Object.create?Object.create(null):{};k.area=!0,k.base=!0,k.br=!0,k.col=!0,k.embed=!0,k.hr=!0,k.img=!0,k.input=!0,k.keygen=!0,k.link=!0,k.menuitem=!0,k.meta=!0,k.param=!0,k.source=!0,k.track=!0,k.wbr=!0;var N={makeKeyIndexAndFree:c,diff:function(e,t,r){function n(e){var t={index:e,type:0};y.push(t)}function i(e,t){var r={index:e,item:t,type:1};y.push(r)}function o(e){k.splice(e,1)}for(var a,s,u=c(e,r),f=c(t,r),l=f.free,p=u.keyIndex,d=f.keyIndex,y=[],v=[],m=0,g=0;m<e.length;){if(a=e[m],s=h(a,r))if(d.hasOwnProperty(s)){var x=d[s];v.push(t[x])}else v.push(null);else{var b=l[g++];v.push(b||null)}m++}var k=v.slice(0);for(m=0;m<k.length;)null===k[m]?(n(m),o(m)):m++;for(var N=m=0;m<t.length;){s=h(a=t[m],r);var C=k[N],A=h(C,r);C?s===A?N++:p.hasOwnProperty(s)&&h(k[N+1],r)===s?(n(m),o(N),N++):i(m,a):i(m,a),m++}return{moves:y,children:v}}}.diff,C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A=0,w=1,S=2,E=3;f.REPLACE=A,f.REORDER=w,f.PROPS=S,f.TEXT=E;return{element:t,parse:function(e){var t,r=[],n=-1,i=[],o={};if((e=e.trim()).replace(b,function(a,u){var c,h="/"!==a.charAt(1),f=u+a.length,l=e.charAt(f);h&&(n++,!(t=function(e){var t=s(e),r=k[t.tagName]||"/>"===e.substring(e.length-2);return{type:"tag",name:t.tagName,voidElement:r,attrs:t.attributes,children:[]}}(a)).voidElement&&l&&"<"!==l&&t.children.push({type:"text",content:d.unescapeString(e.slice(f,e.indexOf("<",f)))}),o[t.tagName]=t,0===n&&r.push(t),(c=i[n-1])&&c.children.push(t),i[n]=t),h&&!t.voidElement||(n--,"<"!==l&&l&&i[n].children.push({type:"text",content:d.unescapeString(e.slice(f,e.indexOf("<",f)))}))}),1!==r.length)throw new Error("Must have one root element");return u(r[0])},diff:function(e,t){var r={};return p(e,t,0,r),r},patch:f}});